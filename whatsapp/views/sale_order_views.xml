<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        
        <!-- Extend Sale Order Form View -->
        <record id="sale_order_view_form_whatsapp" model="ir.ui.view">
            <field name="name">sale.order.form.whatsapp</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//div[@class='oe_button_box']" position="inside">
                    <button name="action_view_whatsapp_messages" type="object" class="oe_stat_button" icon="fa-whatsapp"
                            invisible="whatsapp_message_count == 0">
                        <field name="whatsapp_message_count" widget="statinfo" string="WhatsApp Messages"/>
                    </button>
                    <button name="action_send_whatsapp_message" type="object" class="oe_stat_button" icon="fa-paper-plane"
                            invisible="whatsapp_number == False">
                        <div class="o_stat_info">
                            <span class="o_stat_text">Send WhatsApp</span>
                        </div>
                    </button>
                </xpath>
                
                <notebook position="inside">
                    <page string="WhatsApp" invisible="whatsapp_number == False">
                        <group>
                            <group string="WhatsApp Information">
                                <field name="whatsapp_number" readonly="1"/>
                                <field name="whatsapp_message_count" readonly="1"/>
                            </group>
                        </group>
                        
                        <group string="WhatsApp Messages">
                            <field name="whatsapp_message_ids" nolabel="1">
                                <list>
                                    <field name="timestamp"/>
                                    <field name="direction"/>
                                    <field name="message_type"/>
                                    <field name="message"/>
                                    <field name="status"/>
                                    <field name="account_id"/>
                                    <field name="from_name"/>
                                    <field name="to_name"/>
                                </list>
                            </field>
                        </group>
                        
                        <group string="Quick Actions">
                            <button name="action_send_order_confirmation" type="object" string="Send Order Confirmation" class="btn-primary"/>
                            <button name="action_send_delivery_notification" type="object" string="Send Delivery Notification" class="btn-secondary"/>
                            <button name="action_send_payment_reminder" type="object" string="Send Payment Reminder" class="btn-secondary"/>
                        </group>
                    </page>
                </notebook>
            </field>
        </record>
        
        <!-- Extend Sale Order Tree View -->
        <record id="sale_order_view_tree_whatsapp" model="ir.ui.view">
            <field name="name">sale.order.tree.whatsapp</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='amount_total']" position="after">
                    <field name="whatsapp_number" optional="hide"/>
                </xpath>
                
                <xpath expr="//list" position="attributes">
                    <attribute name="multi_edit">1</attribute>
                </xpath>
                <xpath expr="//list" position="inside">
                    <button name="action_send_whatsapp_message" type="object" title="Send WhatsApp Message" icon="fa-whatsapp"
                            invisible="whatsapp_number == False"/>
                </xpath>
            </field>
        </record>
        
        <!-- Extend Sale Order Search View -->
        <record id="sale_order_view_search_whatsapp" model="ir.ui.view">
            <field name="name">sale.order.search.whatsapp</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_sales_order_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="whatsapp_number"/>
                </xpath>
                
                <xpath expr="//filter[@name='my_sale_orders_filter']" position="after">
                    <separator/>
                    <filter string="Has WhatsApp" name="has_whatsapp" domain="[('whatsapp_number', '!=', False)]"/>
                    <!-- <filter string="WhatsApp Messages" name="whatsapp_messages" domain="[('whatsapp_message_count', '>', 0)]"/> -->
                </xpath>
            </field>
        </record>
        
        <!-- Extend Sale Order Kanban View -->
        <record id="sale_order_view_kanban_whatsapp" model="ir.ui.view">
            <field name="name">sale.order.kanban.whatsapp</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_sale_order_kanban"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="whatsapp_number"/>
                    <field name="whatsapp_message_count"/>
                </xpath>
                
                <xpath expr="//footer" position="inside">
                    <div class="oe_kanban_bottom_right" t-if="record.whatsapp_number.raw_value">
                        <button name="action_send_whatsapp_message" type="object" class="btn btn-sm btn-primary" title="Send WhatsApp Message">
                            <i class="fa fa-whatsapp"/> WhatsApp
                        </button>
                    </div>
                </xpath>
            </field>
        </record>
        
    </data>
</odoo>