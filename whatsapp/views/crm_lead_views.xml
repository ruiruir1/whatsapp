<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        
        <!-- Extend CRM Lead Form View -->
        <record id="crm_lead_view_form_whatsapp" model="ir.ui.view">
            <field name="name">crm.lead.form.whatsapp</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_lead_view_form"/>
            <field name="arch" type="xml">
                <xpath expr="//div[@class='oe_button_box']" position="inside">
                    <button name="action_view_whatsapp_messages" type="object" class="oe_stat_button" icon="fa-whatsapp"
                            invisible="whatsapp_message_count == 0">
                        <field name="whatsapp_message_count" widget="statinfo" string="WhatsApp Messages"/>
                    </button>
                    <button name="action_send_whatsapp_message" type="object" class="oe_stat_button" icon="fa-paper-plane"
                            invisible="whatsapp_number == False">
                        <div class="o_stat_info">
                            <span class="o_stat_text">Send WhatsApp</span>
                        </div>
                    </button>
                </xpath>
                
                <xpath expr="//field[@name='phone']" position="after">
                    <field name="whatsapp_number" widget="phone" options="{'enable_sms': false}"/>
                </xpath>
                
                <notebook position="inside">
                    <page string="WhatsApp" invisible="whatsapp_number == False">
                        <group>
                            <group string="WhatsApp Information">
                                <field name="whatsapp_number"/>
                                <field name="whatsapp_message_count" readonly="1"/>
                            </group>
                        </group>
                        
                        <group string="WhatsApp Messages">
                            <field name="whatsapp_message_ids" nolabel="1">
                                <list>
                                    <field name="timestamp"/>
                                    <field name="direction"/>
                                    <field name="message_type"/>
                                    <field name="message"/>
                                    <field name="status"/>
                                    <field name="account_id"/>
                                    <field name="from_name"/>
                                    <field name="to_name"/>
                                </list>
                            </field>
                        </group>
                    </page>
                </notebook>
            </field>
        </record>
        
        <!-- Extend CRM Lead Tree View -->
        <record id="crm_lead_view_tree_whatsapp" model="ir.ui.view">
            <field name="name">crm.lead.tree.whatsapp</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_tree_view_leads"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='phone']" position="after">
                    <field name="whatsapp_number" optional="hide"/>
                </xpath>
                
                <xpath expr="//list" position="attributes">
                    <attribute name="multi_edit">1</attribute>
                </xpath>
                <xpath expr="//list" position="inside">
                    <button name="action_send_whatsapp_message" type="object" title="Send WhatsApp Message" icon="fa-whatsapp"
                            invisible="whatsapp_number == False"/>
                </xpath>
            </field>
        </record>
        
        <!-- Extend CRM Lead Search View -->
        <record id="crm_lead_view_search_whatsapp" model="ir.ui.view">
            <field name="name">crm.lead.search.whatsapp</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.view_crm_case_leads_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='phone_mobile_search']" position="after">
                    <field name="whatsapp_number"/>
                </xpath>
                
                <xpath expr="//filter[@name='lost']" position="after">
                    <separator/>
                    <filter string="Has WhatsApp" name="has_whatsapp" domain="[('whatsapp_number', '!=', False)]"/>
                    <!-- <filter string="WhatsApp Messages" name="whatsapp_messages" domain="[('whatsapp_message_count', '>', 0)]"/> -->
                </xpath>
            </field>
        </record>
        
        <!-- Extend CRM Lead Kanban View -->
        <record id="crm_lead_view_kanban_whatsapp" model="ir.ui.view">
            <field name="name">crm.lead.kanban.whatsapp</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_kanban_view_leads"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='team_id']" position="after">
                    <field name="whatsapp_number"/>
                    <field name="whatsapp_message_count"/>
                </xpath>
                
                <xpath expr="//footer" position="inside">
                    <div class="oe_kanban_bottom_right" t-if="record.whatsapp_number.raw_value">
                        <button name="action_send_whatsapp_message" type="object" class="btn btn-sm btn-primary" title="Send WhatsApp Message">
                            <i class="fa fa-whatsapp"/> WhatsApp
                        </button>
                    </div>
                </xpath>
            </field>
        </record>
        
    </data>
</odoo>